# 使用指南

## 🚀 快速开始

### 1. 启动应用
```bash
# 推荐方式：使用启动脚本
python start_realtime_voice.py

# 或直接启动主应用
python voice_app.py
```

### 2. 访问应用
- **实时语音对话**: http://localhost:5000/realtime （新功能，推荐）
- **标准语音聊天**: http://localhost:5000/voice
- **简单界面**: http://localhost:5000/

## 🎤 实时语音对话使用方法

### 基本操作
1. **选择AI角色**: 从下拉菜单选择你想对话的AI角色
2. **开始对话**: 点击大的麦克风按钮
3. **语音输入**: 清晰地说出你的问题或想法
4. **自动识别**: 系统会自动检测语音结束并进行识别
5. **AI回复**: 获得文字和语音双重回复

### 高级功能
- **连续对话模式**: 开启后AI回复完成会自动开始下一轮录音
- **空格键快捷操作**: 按住空格键快速开始录音，松开停止
- **音频可视化**: 实时显示语音输入的音频波形
- **智能静音检测**: 自动识别语音停顿，无需手动停止

### 操作技巧
- **录音时长**: 建议3-8秒，避免过短或过长
- **说话清晰**: 语速适中，发音清晰
- **环境安静**: 避免背景噪音干扰
- **麦克风距离**: 保持适当距离，避免过近或过远

## 🎭 AI角色介绍

### 哲学家
- **苏格拉底**: 古希腊哲学家，擅长哲学思辨和启发式对话
- **孔子**: 儒家思想家，专注教育和道德修养

### 科学家
- **爱因斯坦**: 物理学家，科学思维和创新理论
- **玛丽·居里**: 科学家，坚持和突破精神

### 文学家
- **莎士比亚**: 文学大师，诗歌和戏剧创作
- **哈利·波特**: 魔法世界的冒险者

### 教育者
- **李老师**: 中文教师，语言学习和文化交流

## 🛠️ 故障排除

### 麦克风问题
**问题**: 点击麦克风按钮无反应
**解决方案**:
1. 检查浏览器麦克风权限
2. 确保麦克风设备正常工作
3. 尝试刷新页面重新授权
4. 使用HTTPS地址（某些浏览器要求）

### 语音识别问题
**问题**: 录音后显示识别失败
**解决方案**:
1. 检查网络连接
2. 验证百度API密钥配置
3. 确保录音环境安静
4. 尝试调整说话音量和速度
5. 检查录音时长（建议3-8秒）

### 音频播放问题
**问题**: AI回复文字正常但语音无法播放
**解决方案**:
1. 检查浏览器音频播放权限
2. 验证百度TTS服务配置
3. 尝试调整系统音量
4. 检查音频设备连接

### 连续模式问题
**问题**: 连续模式下录音不会自动开始
**解决方案**:
1. 检查WebSocket连接状态
2. 确认AI回复完成
3. 尝试关闭重新开启连续模式
4. 刷新页面重新连接

## 🔧 配置说明

### 环境变量配置
在 `.env` 文件中配置以下参数：

```env
# Flask应用配置
SECRET_KEY=your-secret-key-here

# AI服务配置
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_API_BASE=https://ark.cn-beijing.volces.com/api/v3
OPENAI_MODEL=doubao-seed-1-6-250615

# 百度语音API配置
BAIDU_API_KEY=your_baidu_api_key_here
BAIDU_SECRET_KEY=your_baidu_secret_key_here
```

### 浏览器兼容性
- **推荐浏览器**: Chrome 70+, Edge 79+, Firefox 70+
- **移动端**: Chrome Mobile, Safari Mobile
- **不支持**: Internet Explorer

### 系统要求
- **操作系统**: Windows 10+, macOS 10.14+, Linux
- **Python版本**: 3.8+
- **内存**: 至少2GB可用内存
- **网络**: 稳定的互联网连接

## 📊 性能优化建议

### 网络优化
- 使用稳定的网络连接
- 避免在网络高峰期使用
- 考虑使用有线网络而非WiFi

### 设备优化
- 使用质量较好的麦克风
- 确保充足的系统内存
- 关闭不必要的后台程序

### 使用习惯
- 在安静环境中使用
- 避免同时运行多个语音应用
- 定期清理浏览器缓存

## 🎯 最佳实践

### 对话技巧
1. **明确表达**: 清晰表达你的问题或需求
2. **适当停顿**: 说话时适当停顿，便于识别
3. **逐步深入**: 从简单问题开始，逐步深入讨论
4. **利用角色特点**: 根据AI角色的专长提问

### 功能使用
1. **选择合适角色**: 根据话题选择最合适的AI角色
2. **合理使用连续模式**: 长对话时开启，短问答时关闭
3. **注意录音质量**: 确保清晰的语音输入
4. **及时反馈**: 遇到问题及时查看错误提示

## 🔧 最新修复

### 重复回复问题修复 (已解决)
我们修复了主页面语音对话中出现重复AI回复的问题：

1. **事件监听器重复**: 移除了重复的 `ai_response` 和 `tts_result` 事件监听器
2. **后端事件统一**: 统一使用 `chat_response` 事件发送AI回复
3. **音频处理优化**: 音频URL现在通过统一事件一起发送
4. **用户体验改善**: 确保每个用户消息只产生一个AI回复

现在与虚拟人物对话时只会看到一个AI回复，不再有重复显示问题。

### 实时语音识别问题修复 (已解决)
我们修复了实时语音聊天中语音识别不正确的问题：

1. **音频转换器缺失**: 实时语音聊天页面现在正确引入了音频转换器脚本
2. **音频格式处理**: 统一了WebM到WAV的音频格式转换逻辑  
3. **错误处理**: 改进了音频转换失败时的错误提示
4. **状态显示**: 添加了音频转换过程的状态提示

现在实时语音聊天和标准语音聊天使用相同的语音识别流程，确保识别准确性。

## 📞 技术支持

### 自助诊断
1. 运行测试脚本: `python test_realtime_voice.py`
2. 运行语音识别测试: `python test_voice_recognition.py`
3. 运行重复回复测试: `python test_duplicate_response.py`
4. 查看浏览器控制台错误信息
5. 检查服务端日志输出

### 常见错误代码
- **400**: 请求参数错误
- **401**: API密钥无效
- **403**: 权限不足
- **500**: 服务器内部错误
- **503**: 服务暂时不可用

### 获取帮助
如果遇到无法解决的问题，请：
1. 查看本文档的故障排除部分
2. 运行测试脚本获取详细错误信息
3. 检查环境配置是否正确
4. 提交Issue并附上详细的错误信息和日志